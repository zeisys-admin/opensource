{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": {
        "WEBSERVER101": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "ImageId": "ami-03eba3a4963ae90fd",
                "InstanceType": "t2.micro",
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "yum update -y\n",
                                "yum install -y docker\n",
                                "service docker start\n",
                                "chkconfig docker on\n",
                                "mkdir /home/ec2-user/js\n",
                                "echo \"<html ng-app=\\\"demoApp\\\">\n  <head>\n  <meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=ISO-8859-1\\\">\n  <title>AngularJs Demo</title>\n  <script src=\\\"https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js\\\"></script>\n  <script src=\\\"js/angulardemo.js\\\"></script>\n  </head>\n  <body>\n  <h1>AngularJS Demo v1.3</h1>\n  <div ng-controller=\\\"demoCtrl\\\">\n  <table border=\\\"1\\\">\n  <tr>\n  <td>Book Name</td>\n  <td ng-bind=\"book\"></td>\n  </tr>\n  <tr>\n  <td>Author</td>\n  <td ng-bind=\\\"author\\\"></td>\n  </tr>\n  </table>\n  </div>\n  </body>\n  </html>\" > /home/ec2-user/index.html\n",
                                "echo \"var app = angular.module(\\\"demoApp\\\", []);\n  app.controller(\\\"demoCtrl\\\", function(\\$scope) {\n  \\$scope.book = \\\"The Alchemist\\\";\n  \\$scope.author = \\\"Paulo Coelho\\\";\n  });\" > /home/ec2-user/js/angulardemo.js\n",
                                "docker run -dit --name angularjs-app -p 80:80 -v /home/ec2-user:/usr/local/apache2/htdocs/ httpd:2.4\n",
                                "sleep 30\n",
                                "docker exec angularjs-app chmod -R 755 htdocs\n"
                            ]
                        ]
                    }
                },
                "SubnetId": "subnet-096bc559effe90267",
                "Tags": [
                    {
                        "Key": "User",
                        "Value": "Anoop"
                    },
                    {
                        "Key": "costcenter",
                        "Value": "6037160600"
                    },
                    {
                        "Key": "Name",
                        "Value": "Web Application 101"
                    }
                ],
                "SecurityGroupIds": [
                    {
                        "Ref": "stacksg"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "505c4bca-ee28-4134-ba91-e46c2f6095f3"
                }
            }
        },
        "APPSERVER101": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "ImageId": "ami-03eba3a4963ae90fd",
                "InstanceType": "t2.micro",
                "SubnetId": "subnet-096bc559effe90267",
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "yum update -y\n",
                                "yum install -y docker\n",
                                "service docker start\n",
                                "chkconfig docker on\n",
                                "docker run -d -p 80:5000 training/webapp:latest\n"
                            ]
                        ]
                    }
                },
                "Tags": [
                    {
                        "Key": "User",
                        "Value": "Anoop"
                    },
                    {
                        "Key": "costcenter",
                        "Value": "6037160600"
                    },
                    {
                        "Key": "Name",
                        "Value": "Application Server 101"
                    }
                ],
                "SecurityGroupIds": [
                    {
                        "Ref": "stacksg"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "db973ea4-eb75-4faf-a25b-30b49cf43d1d"
                }
            }
        },
        "DBSERVER101": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "ImageId": "ami-03eba3a4963ae90fd",
                "InstanceType": "t2.micro",
                "SubnetId": "subnet-096bc559effe90267",
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "yum update -y\n",
                                "yum install -y docker\n",
                                "service docker start\n",
                                "chkconfig docker on\n",
                                "docker swarm init\n",
                                "echo \"version: '3.1'\nservices:\n  mongo:\n    image: mongo\n    restart: always\n    environment:\n      MONGO_INITDB_ROOT_USERNAME: root\n      MONGO_INITDB_ROOT_PASSWORD: example\n  mongo-express:\n    image: mongo-express\n    restart: always\n    ports:\n      - 80:8081\n    environment:\n      ME_CONFIG_MONGODB_ADMINUSERNAME: root\n      ME_CONFIG_MONGODB_ADMINPASSWORD: example\" > /home/ec2-user/stack.yml\n",
                                "docker stack deploy -c /home/ec2-user/stack.yml mongo\n"
                            ]
                        ]
                    }
                },
                "Tags": [
                    {
                        "Key": "User",
                        "Value": "Anoop"
                    },
                    {
                        "Key": "costcenter",
                        "Value": "6037160600"
                    },
                    {
                        "Key": "Name",
                        "Value": "Database Server 101"
                    }
                ],
                "SecurityGroupIds": [
                    {
                        "Ref": "stacksg"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "16e7b898-e2c2-487d-b8fb-28c76941f695"
                }
            }
        },
        "stacksg": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupName": {
                    "Ref": "AWS::StackName"
                },
                "GroupDescription": "Security group for stack"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                }
            }
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Designer": {
            "16e7b898-e2c2-487d-b8fb-28c76941f695": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 90,
                    "y": 150
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                ]
            },
            "db973ea4-eb75-4faf-a25b-30b49cf43d1d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": -30,
                    "y": 150
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                ]
            },
            "505c4bca-ee28-4134-ba91-e46c2f6095f3": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": -150,
                    "y": 150
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                ]
            },
            "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": -30,
                    "y": 230
                },
                "z": 0,
                "embeds": []
            },
            "be58ba80-df85-4447-8afa-63e74a4bfb72": {
                "source": {
                    "id": "505c4bca-ee28-4134-ba91-e46c2f6095f3"
                },
                "target": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                },
                "z": 2
            },
            "2fd79048-c2e1-4c77-8530-869d2964fb28": {
                "source": {
                    "id": "db973ea4-eb75-4faf-a25b-30b49cf43d1d"
                },
                "target": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                },
                "z": 3
            },
            "a760a986-915b-4ce2-bac2-b3b53e1bdefa": {
                "source": {
                    "id": "16e7b898-e2c2-487d-b8fb-28c76941f695"
                },
                "target": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                },
                "z": 4
            }
        }
    }
}{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": {
        "WEBSERVER101": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "ImageId": "ami-03eba3a4963ae90fd",
                "InstanceType": "t2.micro",
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "yum update -y\n",
                                "yum install -y docker\n",
                                "service docker start\n",
                                "chkconfig docker on\n",
                                "mkdir /home/ec2-user/js\n",
                                "echo \"<html ng-app=\\\"demoApp\\\">\n  <head>\n  <meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=ISO-8859-1\\\">\n  <title>AngularJs Demo</title>\n  <script src=\\\"https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js\\\"></script>\n  <script src=\\\"js/angulardemo.js\\\"></script>\n  </head>\n  <body>\n  <h1>AngularJS Demo v1.3</h1>\n  <div ng-controller=\\\"demoCtrl\\\">\n  <table border=\\\"1\\\">\n  <tr>\n  <td>Book Name</td>\n  <td ng-bind=\"book\"></td>\n  </tr>\n  <tr>\n  <td>Author</td>\n  <td ng-bind=\\\"author\\\"></td>\n  </tr>\n  </table>\n  </div>\n  </body>\n  </html>\" > /home/ec2-user/index.html\n",
                                "echo \"var app = angular.module(\\\"demoApp\\\", []);\n  app.controller(\\\"demoCtrl\\\", function(\\$scope) {\n  \\$scope.book = \\\"The Alchemist\\\";\n  \\$scope.author = \\\"Paulo Coelho\\\";\n  });\" > /home/ec2-user/js/angulardemo.js\n",
                                "docker run -dit --name angularjs-app -p 80:80 -v /home/ec2-user:/usr/local/apache2/htdocs/ httpd:2.4\n",
                                "sleep 30\n",
                                "docker exec angularjs-app chmod -R 755 htdocs\n"
                            ]
                        ]
                    }
                },
                "SubnetId": "subnet-096bc559effe90267",
                "Tags": [
                    {
                        "Key": "User",
                        "Value": "Anoop"
                    },
                    {
                        "Key": "costcenter",
                        "Value": "6037160600"
                    },
                    {
                        "Key": "Name",
                        "Value": "Web Application 101"
                    }
                ],
                "SecurityGroupIds": [
                    {
                        "Ref": "stacksg"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "505c4bca-ee28-4134-ba91-e46c2f6095f3"
                }
            }
        },
        "APPSERVER101": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "ImageId": "ami-03eba3a4963ae90fd",
                "InstanceType": "t2.micro",
                "SubnetId": "subnet-096bc559effe90267",
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "yum update -y\n",
                                "yum install -y docker\n",
                                "service docker start\n",
                                "chkconfig docker on\n",
                                "docker run -d -p 80:5000 training/webapp:latest\n"
                            ]
                        ]
                    }
                },
                "Tags": [
                    {
                        "Key": "User",
                        "Value": "Anoop"
                    },
                    {
                        "Key": "costcenter",
                        "Value": "6037160600"
                    },
                    {
                        "Key": "Name",
                        "Value": "Application Server 101"
                    }
                ],
                "SecurityGroupIds": [
                    {
                        "Ref": "stacksg"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "db973ea4-eb75-4faf-a25b-30b49cf43d1d"
                }
            }
        },
        "DBSERVER101": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "ImageId": "ami-03eba3a4963ae90fd",
                "InstanceType": "t2.micro",
                "SubnetId": "subnet-096bc559effe90267",
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "yum update -y\n",
                                "yum install -y docker\n",
                                "service docker start\n",
                                "chkconfig docker on\n",
                                "docker swarm init\n",
                                "echo \"version: '3.1'\nservices:\n  mongo:\n    image: mongo\n    restart: always\n    environment:\n      MONGO_INITDB_ROOT_USERNAME: root\n      MONGO_INITDB_ROOT_PASSWORD: example\n  mongo-express:\n    image: mongo-express\n    restart: always\n    ports:\n      - 80:8081\n    environment:\n      ME_CONFIG_MONGODB_ADMINUSERNAME: root\n      ME_CONFIG_MONGODB_ADMINPASSWORD: example\" > /home/ec2-user/stack.yml\n",
                                "docker stack deploy -c /home/ec2-user/stack.yml mongo\n"
                            ]
                        ]
                    }
                },
                "Tags": [
                    {
                        "Key": "User",
                        "Value": "Anoop"
                    },
                    {
                        "Key": "costcenter",
                        "Value": "6037160600"
                    },
                    {
                        "Key": "Name",
                        "Value": "Database Server 101"
                    }
                ],
                "SecurityGroupIds": [
                    {
                        "Ref": "stacksg"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "16e7b898-e2c2-487d-b8fb-28c76941f695"
                }
            }
        },
        "stacksg": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupName": {
                    "Ref": "AWS::StackName"
                },
                "GroupDescription": "Security group for stack"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                }
            }
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Designer": {
            "16e7b898-e2c2-487d-b8fb-28c76941f695": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 90,
                    "y": 150
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                ]
            },
            "db973ea4-eb75-4faf-a25b-30b49cf43d1d": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": -30,
                    "y": 150
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                ]
            },
            "505c4bca-ee28-4134-ba91-e46c2f6095f3": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": -150,
                    "y": 150
                },
                "z": 1,
                "embeds": [],
                "isassociatedwith": [
                    "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                ]
            },
            "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": -30,
                    "y": 230
                },
                "z": 0,
                "embeds": []
            },
            "be58ba80-df85-4447-8afa-63e74a4bfb72": {
                "source": {
                    "id": "505c4bca-ee28-4134-ba91-e46c2f6095f3"
                },
                "target": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                },
                "z": 2
            },
            "2fd79048-c2e1-4c77-8530-869d2964fb28": {
                "source": {
                    "id": "db973ea4-eb75-4faf-a25b-30b49cf43d1d"
                },
                "target": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                },
                "z": 3
            },
            "a760a986-915b-4ce2-bac2-b3b53e1bdefa": {
                "source": {
                    "id": "16e7b898-e2c2-487d-b8fb-28c76941f695"
                },
                "target": {
                    "id": "89fbeeeb-b131-4f6e-a8d4-9d20fde9c99e"
                },
                "z": 4
            }
        }
    }
}
